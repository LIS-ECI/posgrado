<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.


-->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="proyecto.dao.mybatis.mappers.ClaseMapper">
   
    <select parameterType="map" id="consultarClase" resultMap="ClaseResult">
        SELECT
        
        cla.id,
        cla.hora_inicio,
        cla.hora_fin,
        cla.fecha,
        
        co.id as CO_id,
        co.fecha_inicio CO_fecha_inicio,
        co.fecha_fin CO_fecha_fin,
        
        mat.nombre as MAT_nombre
        
	FROM clase as cla 
        join materiacohorte as matco on 
        matco.materia_sigla=cla.materia_cohorte_materia_sigla 
        and matco.cohorte_id=cla.materia_cohorte_cohorte_id
        join materia as mat on mat.sigla=matco.materia_sigla
        join cohorte as co on co.id=matco.cohorte_id;
    </select>
    
    <select parameterType="map" id="consultarClaseXperiodo" resultMap="ClaseResult">
        SELECT
        
        cla.id,
        cla.hora_inicio,
        cla.hora_fin,
        cla.fecha,
        
        co.id as CO_id,
        co.fecha_inicio as CO_fecha_inicio,
        co.fecha_fin as CO_fecha_fin,
        co.periodo as CO_periodo,
        
        mat.sigla as MAT_sigla,
        mat.nombre as MAT_nombre,
        mat.creditos as MAT_creditos,
        mat.descripcion as MAT_descripcion,
        
        asi.id as MAT_ASI_id,
        asi.nombre as MAT_ASI_nombre,
        
        pos.id as MAT_ASI_POS_id,
        pos.nombre as MAT_ASI_POS_id,
        pos.creditos as MAT_ASI_POS_id
        
	FROM clase as cla 
        join materiacohorte as matco on 
        matco.materia_sigla=cla.materia_cohorte_materia_sigla 
        and matco.cohorte_id=cla.materia_cohorte_cohorte_id
        join materia as mat on mat.sigla=matco.materia_sigla
        join cohorte as co on co.id=matco.cohorte_id
        join Asignatura as asi on mat.Asignatura_id = asi.id
        join Posgrado as pos on asi.Posgrado_id = pos.id 
        
        WHERE co.periodo = #{periodo}
        
        ORDER BY asi.id, co.id
    </select>
    
    <resultMap type='Clase' id='ClaseResult'>
        <id property='id' column='id'/>
        <result property='hora_inicio' column='hora_inicio'/>
        <result property='hora_fin' column='hora_fin'/>   
        <result property='fecha' column='fecha'/>      
        <association property="materia_cohorte_id" javaType="Cohorte" columnPrefix='CO_' resultMap='proyecto.dao.mybatis.mappers.CohorteMapper.CohorteResult'></association>      
        <association property="materia_cohorte_sigla" javaType="Materia" columnPrefix='MAT_' resultMap='proyecto.dao.mybatis.mappers.MateriaMapper.MateriaResult'></association>      

    </resultMap>
    
    
</mapper>